# delphi.js (prototype)

### My tribute to Delphi 7. Let the Web be your new home
### Live demo at [Netlify](https://delphi-js-prototype.netlify.com/)

## TApplication - объект в глобальной зоне видимости window

### Свойства

* mbOK, mbYES, mbNO, mbAbort, mbRetry, mbIgnore, mbClose, mbCancel: идентификаторы кнопок диалогового окна
* mrOK, mrYES, mbrO, mrAbort, mrRetry, mrIgnore, mrClose, mrCancel: значения modalResult модальных окон при закрытии.
* mtWarning, mtError, mtInformation, mtConfirmation, mtCustom: типы диалогового окна
* animationEnabled: флаг использования анимации для контролов
* caption: общее названия приложения.
* core: ссылка на объект служебных методов и свойств
  * core.modalStack: ссылка на массив форм, открытых в модальном режиме
  * core.overlay: ссылка на объект компонента оверлея
  * core.messageDlg: ссылка на объект компонента диалога
  * core.datePickerDlg: ссылка на объект компонента диалога выбора даты
  * core.mainForm: ссылка на объект главной формы приложения

* vcl: ссылка на объект описания компонентов Delphi.js

### Методы

* core.createComponent(componentSettings): создание нового компонента с параметрами componentSettings
* core.getComponent(componentName): получение ссылки на компонент с идентификатором componentName
* core.destroyComponent(componentName): уничтожение компонента с идентификатором componentName
* core.getProperty(settingName): получение настройки приложения с идентификатором settingName
* core.getRadioButtonsByGroup(groupName): получение массива всех компонентов-радиокнопок, с указанной группой groupName
* core.getComponentsByClassName(className): получение массива всех компонентов приложения с указанным классом className
* core.animate(options): вызов анимации для контрола.
  * options.duration - длительность анимации, мс. При отсутсвии берётся значение из applicationSettings.animationSpeed
  * options.timing - временнАя функция. При отсутсвии берётся значение из applicationSettings.animationTimingLinear
  * options.draw - функция на изменение значение функции options.timing
  * options.callback - функция, вызываемая после завершения анимации

* messageDlgCustom(dlgParams): подготовка и получение ссылки на объект настраиваемого диалогового окна.
  * dlgParams.type - тип диалогового окна (mtWarning, mtError, mtInformation, mtConfirmation, mtCustom)
  * dlgParams.caption - заголовок окна
  * dlgParams.message - сообщение окна
  * dlgParams.buttons - массив идентификаторов кнопок диалогового окна, которые нужно отобразить

* messageDlgConfirmation(message): предустановленный диалог подтверждения действия пользователя.
  * message - сообщение окна

* messageDlgInformation(message): предустановленный диалог информирования пользователя.
  * message - сообщение окна

* messageDlgError(message): предустановленный диалог сообщения об ошибке пользователя.
  * message - сообщение окна

* messageDlgWarning(message): предустановленный диалог предупреждения пользователя.
  * message - сообщение окна

* initialize(): инициализация объекта TApplication, для работы приложения
* getOrCreate(path_to_definition): создание или получение имеющейся формы или дата-модуля на основании настроек в файле definition.json, расположенном по пути _path_to_definition_

* createDataModule(moduleDef): создание дата-модуля на основании настроек moduleDef
* terminate(): завершение приложения и очистка памяти
* run(): отправка сообщения Application.onReady

---

## TComponent - базовый объект для всех компонентов

### Методы

* setProperty(settingName, settingValue): установка настройки settingName в значение settingValue
* getProperty(settingName): получение настройки компонента с идентификатором settingName
* createContent(): если компонент является контейнером для других компонентов - создание этих компонентов
* destroy(): уничтожение компонента, DOM-узла, освобождение памяти

---

## TComponent -> TControl - визуальный компонент

### Свойства

* isVisible - флаг видимости компонента
* container - ссылка на DOM-узел контейнера компонента
* style: ссылка на объект стилей DOM-узла контейнера компонента
* caption: заголовок компонента

### Методы

* setEventListener(eventName, fnc, runOnce = false): метод установки обработчика на события компонента
  * eventName - название события компонента
  * fnc - функция, вызываемая при возникновения события
  * runOnce - флаг вызова функции fnc один раз на событие eventName. По умолчанию = false

* createNode(): создание DOM-узла компонента. При этом используется настройки componentSettings, переданные в конструктор компонента

  * registerName - записывается в id DOM-узла контейнера компонента
  * className - добавляется в classList DOM-узла контейнера компонента
  * multiLine - флаг многострочности содержимого компонента.
    * true - style.whiteSpace = normal
    * false -  style.whiteSpace = nowrap
  * color - цвет текста компонента (style.color). При отсутствии - берётся из умолчаний компонента
  * fontSize - размер текста компонента (style.fontSize). Указывается в виде строки, например '12px'
  * fontWeight - значение плотности текста компонента (style.fontWeight). Указывается в виде строки, например 'bold'
  * fontStyle - значение стиля текста компонента (style.fontStyle). Указывается в виде строки, например 'italic'
  * textAlign - значение горизонтального выравнивания текста компонента (style.textAlign). Указывается в виде строки, например 'center'.
  * width - ширина контейнера компонента, px.
  * minWidth - минимальная ширина контейнера компонента, px.
  * height - высота контейнера компонента, px.
  * minHeight - минимальная высота контейнера компонента, px.
  * top - расстояние от верхней границы контейнера компонента, до верхней границы родительского контейнера, px.
  * left - расстояние от левой границы контейнера компонента, до левой границы родительского контейнера, px.
  * right - расстояние от правой границы контейнера компонента, до правой границы родительского контейнера, px.
  * bottom - расстояние от нижней границы контейнера компонента, до нижней границы родительского контейнера, px.
  * visible - флаг отображения документа.
    * true / undefined - visibility = "unset", свойство компонента isVisible = true.
    * false - style.visibility = "hidden",  свойство компонента isVisible = false.
  * enabled - флаг активности компонента.
    * true - свойство компонента isEnabled = true. У контейнера компонента убирается класс applicationSettings.disabledClassName, у всех вложенных компонентов вызывается метод enabled(true).
    * false - свойство компонента isEnabled = false, контейнеру компонента добавляется класс applicationSettings.disabledClassName, у всех вложенных компонентов вызывается метод enabled(false)

* click(): метод программного клика на контейнер компонента.
* show(): метод для визуального появления компонента. Контейнер компонента посылает кастомное событие "show"
* hide(): метод для визуального прятания компонента. Контейнер компонента посылает кастомное событие "hide"
* enabled(status): получение текущего статуса активности (status === undefined), или установка статуса активности компонента. При этом:
  * свойство TComponent.isEnabled устанавливается в значение status, если status !== undefined
  * у всех вложенных компонентов вызывается метод enabled(status), если status !== undefined

* invalidated(status): получение текущего статуса корректности значения компонента (status === undefined), или установка статуса корректности значения компонента. При этом:
  * свойство TComponent.isInvalidated устанавливается в значение status, если status !== undefined
  * у всех вложенных компонентов вызывается метод invalidated(status), если status !== undefined

* checked(status): получение текущего статуса выбранности (status === undefined), или установка статуса выбранности компонента. При этом:
  * свойство TComponent.isChecked устанавливается в значение status, если status !== undefined

* fadeIn(callback): метод для анимированного появления компонента, с использованием TApplication.animate(options)
  * callback - функция, которая вызывается после полного появления компонента.

* fadeOut(callback): метод для анимированного прятания компонента, с использованием TApplication.animate(options)
  * callback - функция, которая вызывается после полного прятания компонента.

### Методы-обёртки над TComponent.setEventListener(), для подписки на события

* onClick(fnc, runOnce): метод для подписки на событие click компонента.
  * fnc - функция, вызываемая при возникновения события
  * runOnce - флаг вызова функции fnc один раз на собы

* onShow(fnc, runOnce): метод для подписки на событие show компонента.
  * fnc - функция, вызываемая при возникновения события
  * runOnce - флаг вызова функции fnc один раз на событие

* onHide(fnc, runOnce): метод для подписки на событие hide компонента.
  * fnc - функция, вызываемая при возникновения события
  * runOnce - флаг вызова функции fnc один раз на событие

* onChange(fnc, runOnce): метод для подписки на событие onchange компонента.
  * fnc - функция, вызываемая при возникновения события
  * runOnce - флаг вызова функции fnc один раз на событие

* onInput(fnc, runOnce): метод для подписки на событие oninput компонента.
  * fnc - функция, вызываемая при возникновения события
  * runOnce - флаг вызова функции fnc один раз на событие

---

## TComponent -> TControl -> TOverlay - оверлей для отображения модальных окон

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Потом, дополнительно, контейнеру компонента устанавливаеся z-index из настроек приложения overlayZindex.

* show(): метод для визуального появления компонента. Сначала вызывается метод предка TControl.show(). Потом вызывается метод TControl.fadeIn().
* hide(): метод для визуального прятания компонента. Сначала вызывается метод предка TControl.hide(). Потом вызывается метод TControl.fadeOut().
* getZIndex(): метод получения текущего значение z-index контейнера компонента, приведённого к целому числу.

---

## TComponent -> TControl -> TSpinner - индикатор длительного процесса

### Методы

   * createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Потом, дополнительно, контейнеру компонента устанавливаеся z-index из настроек приложения spinnerZindex.

---

## TComponent -> TControl -> TForm - форма, контейнер для остальных визуальных компонентов

### Свойства

* isModal - флаг модальности окна
* modalResult - см. TApplication: значения modalResult модальных окон при закрытии.

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Настраиваются обработчики перетаскивания окна мышкой за панель заголовка. Настраиваются обработчики изменения окна мышкой за треугольник изменения размера формы. Проводится дополнительная настройка компонента, в зависимости от переданных параметров.

  * icon - изображение для иконки формы (левый угол панели заголовка) в виде ссылки на файл. Указывает путь от корня приложения до файла с иконкой
  * iconBase64 - изображение для иконки формы (левый угол панели заголовка) в виде BASE64-строки
    * iconBase64.type - MIME-тип ресурса ("png", "jpg", "gif")
    * iconBase64.date - BASE64-строка с ресурсом
  * noTitle - у формы не рисуется панель заголовка с иконкой, названием и кнопкой закрытия окна
  * sizeable - флаг возможности менять размеры окна.
    * true - в правом нижнем углу формы отображается треугольник для изменения размеров формы
    * false - изменение размеров формы невозможно

* align(): метод выравнивания формы по центру окна браузера. Доступен, если в настройках формы указано свойство screenCenter = true.

* show(): метод для визуального появления формы. Сначала вызывается метод предка TControl.show(). Потом последовательно вызываются методы TForm.align(), TForm.bringToFront(), TForm.fadeIn(). Если хотя бы одна форма уже отображена в модальном режиме, вызов метода show() заменяется на showModal().

* showModal(): метод для визуального появления формы в модальном режиме. Форма отображается поверх оверлея, закрывающего остальные формы. Добавляется элемент в массив TApplication.modalStack.

* hide(): метод для визуального прятания компонента. Сначала вызывается метод TControl.fadeOut(). Потом вызывается метод предка TControl.hide().
  * Если форма была отображена в модальном режиме - убирается ссылка на неё из массива TApplication.modalStack
  * Если закрывается главное окно приложения (настройка формы isMainForm = true) - приложение завершается вызовом метода TApplication.terminate()

* bringToFront(): метод для отображения формы поверх остальных форм.

* hideQuery(): если определён программистом - вызывается перед закрытием форм для возможности отменить закрытие

---

## TComponent -> TControl -> TForm -> TMessageDlg - диалог принятия решения / информирования пользователя

---

## TComponent -> TControl -> TForm -> TDatePickerDlg - диалог выбора даты

### Свойства

* date - текущая выбранная дата

### Методы

* refresh(): перерисовка компонента в зависимости от свойства date.
* showModal(): сначала анализируется свойство date, переданное при вызове диалога. Если date === undefined, свойство устанавливается в текущую дату. После установки даты диалог перерисовывается методом TDatePickerDlg.refresh(), далее вызывается метод TForm.showModal()

---

## TComponent -> TControl -> TPanel - панель, контейнер для визуальных компонентов, визуальное зонирование

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Потом проводится дополнительная настройка, в зависимости от переданных параметров:
  * caption - если указано, то в левом верхнем углу панели отображатется её заголовок с текстом caption
  * border - если указано значение false, то форма отображатеся без границ
  * depressed - если указано значение true, и border === true или не указано, то панель отрисовывается "вдавленной".
  * backgroundColor - строка с валидным CSS-определением цвета фона панели

---

## TComponent -> TControl -> TPanel -> TScrollBox - панель с полосами прокрутки

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TPanel.createNode(). Потом проводится дополнительная настройка, в зависимости от переданных параметров:
  * scrollX - если равно true, то реализуется горизонтальный скроллинг
  * scrollY - если равно true, то реализуется вертикальный скроллинг

---

## TComponent -> TControl -> TButton - кнопка

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Проводится дополнительная настройка компонента, в зависимости от переданных параметров.
  * toolTip - всплывающая подсказка для кнопки
  * caption - метка на кнопке

---

## TComponent -> TControl -> TButton -> TBitButton - кнопка c иконкой

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TButton.createNode(). Проводится дополнительная настройка компонента, в зависимости от переданных параметров.
  * icon - изображение для иконки кнопки в виде ссылки на файл.Указывает путь от корня приложения до файла с иконкой
  * iconBase64 - изображение для иконки кнопки в виде BASE64-строки
    * iconBase64.type - MIME-тип ресурса ("png", "jpg", "gif")
    * iconBase64.date - BASE64-строка с ресурсом

---

## TComponent -> TControl -> TPanel -> TToolBar - панель инструментов

---

## TComponent -> TControl -> TButton -> TBitButton -> TToolButton - кнопка для панели инструментов

---

## TComponent -> TToolBarSeparator - разделитель для кнопок на панели инструментов

---

## TComponent -> TControl -> TEdit - поле ввода. Построен на основе HTML-элемента INPUT TYPE="TEXT"

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Потом проводится дополнительная настройка, в зависимости от переданных параметров:
  * password - если параметр === true, то поле преобразутеся в поле ввода пароля (input type = "password")
  * placeholder - добавляет текст-заменитель для пустого поля ввода

* value(val): метод получения (val === undefined) или установки значения компонента

* enabled(status): если передано значение status, сначала вызывается метод предка TControl.enabled(status), а потом внтутреннему HTML-элементу input устанавливается атрибут disabled, в зависимости от значения status

---

## TComponent -> TControl -> TEdit -> TDatePicker - поле ввода даты

### Свойства

* date - значение даты компонента в виде объекта Date()
* dateStringISO - значение даты компонента в виде строки формата "YYYY-MM-DD", например "2017-03-19"
* dateStringValue - значение даты компонента в виде строки формата "DD-MM-YYYY", например "19-03-2017"

### Методы

* value(val): Переопределяется метод предка TEdit.value(val):
  * если val === undefined - возвращатеся значение компонента в виде объекта с полями date, dateStringISO, dateStringValue
  * если val - это объект типа Date() или строка с датой в формате ISO,устанавливается новое значение полей компонента

---

## TComponent -> TControl -> TComboBox - выпадающий список. Построен на основе HTML-элемента SELECT

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Дополнительно добавляется кнопка для вызова выпадающего списка. Проводится дополнительная настройка компонента, в зависимости от переданных параметров:
  * items - если передано, то используется для наполнения компонента значениями. Формат данных: [ ["1", "Первый элемент"],  ["2", "Второй элемент"] ... ]

* enabled(status): если передано значение status, сначала вызывается метод предка TControl.enabled(status), а потом внтутреннему HTML-элементу select устанавливается атрибут disabled, в зависимости от значения status

* value(val): Переопределяется метод предка TControl.value(val).
  * если val === undefined - возвращается индекс текущего выбранного элемента
  * если val !== undefined - то выбранным элементом назначается элемент с индексом val

* valueText(): возвращает текстовое (видимое пользователю) значение выбранного элемента.

* setData(items): метод для наполнения компонента значениями. Формат данных: [ ["1", "Первый элемент"],  ["2", "Второй элемент"] ... ]

---

## TComponent -> TControl -> TStaticText - строка текста

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Потом проводится дополнительная настройка, в зависимости от переданных параметров:
  * caption - содержимое строки
  * multiLine - возможность отображать содержимое в несколько строк

---

## TComponent -> TControl -> TCheckBox - Флаг

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Дополнительно визуальный элемент состояния - выбран / не выбран. Дополнительно навешивается обработчик клика на контейнер компонента, для смены состояния.

---

## TComponent -> TControl -> TRadioButton - радиокнопка

### Свойства

* radioButtonGroup - группа радиокнопок, в рамках которой будет проводиться переключение. Устанавливается автоматически на основе идентификатора родительского контейнера (панель, скролбокс, форма).

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Дополнительно визуальный элемент состояния - выбран / не выбран. Дополнительно навешивается обработчик клика на контейнер компонента, для смены состояния.

---

## TComponent -> TControl -> TMemo - многострочное поле ввода. Построен на основе HTML-элемента TEXTAREA

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Потом проводится дополнительная настройка, в зависимости от переданных параметров:
  * placeholder - добавляет текст-заменитель для пустого поля ввода
  * value(val): метод получения (val === undefined) или установки значения компонента
  * enabled(status): если передано значение status, сначала вызывается метод предка TControl.enabled(status), а потом внтутреннему HTML-элементу input устанавливается атрибут disabled, в зависимости от значения status

---

## TComponent -> TControl -> TPicture - изображение

### Методы

* createNode(): создание DOM-узла компонента. Сначала вызывается метод предка TControl.createNode(). Проводится дополнительная настройка компонента, в зависимости от переданных параметров.
  * image - ссылка на файл изображения.Указывает путь от корня приложения до файла
  * backgroundColor - строка с валидным CSS-определением цвета фона изображения
  * backgroundRepeat - установка css-свойства [background-repeat](https://developer.mozilla.org/en-US/docs/Web/CSS/background-repeat)
  * backgroundPosition - установка css-свойства [background-position](https://developer.mozilla.org/en-US/docs/Web/CSS/background-position)
  * backgroundClip - установка css-свойства [background-clip](https://developer.mozilla.org/en-US/docs/Web/CSS/background-clip)
  * backgroundSize - установка css-свойства [background-size](https://developer.mozilla.org/en-US/docs/Web/CSS/background-size)

* setImage(imagePath): установка / замена изображения.
  * imagePath - ссылка на файл изображения.Указывает путь от корня приложения до файла

---

## TComponent -> TDataModule - контейнер для невизуальных компонентов. Аналог TForm

---

## TComponent -> TDataModuleGroup - контейнер для невизуальных компонентов внутри TDataModule, для группировки невизуальных компонентов. 

Аналог TPanel

---

## TComponent -> TAjax - невизульный компонент для асинхронной отправки запроса к серверу и обработки ответа.

Работает на основе XMLHttpRequest()

## Свойства

* data - объект передаваемых параметров, где ключ - имя параметра, значение - значение параметра
* headers - объект пользовательских заголовков для запроса, где ключ - имя заголовка, значение - значение заголовка
* onSuccessHandler - функция, выполняющаяся в случае успешного завершения запроса
* onAbortHandler - функция, выполняющаяся в случае отмены запроса
* URL - ссылка на вызываемый ресурс на сервере

## Методы

* execute(): выполнение запроса

---